{% extends "base.html" %}

{% block header %}
    {% block title %} {% endblock %}
{% endblock %}

{% block content %}
    <main>
        <script type="text/babel">
            /* INIT */
            var team_data = {{ data|tojson|safe }};

            $(function () {
                $("#get_team_member_btn").hide();
                $("#edit_prompt_btn").hide();
                $("#summary-container").hide();
                $("#submit_prompt_btn").click(function () {
                    let prompt = $("#prompt_input").val()
                    submit_prompt(prompt);
                })

                $("#edit_prompt_btn").click(function () {
                    show_prompt_editing(team_data)
                })
            });

            function show_prompt_editing(data) {
                console.log(data);
                $("#edit_summary_div").show();
            }

            function show_summary(data) {
                console.log(data);
                $("#show_summary").text(data["summary"])
                $("#display_highlights").empty();
                $("#display_highlights").append("<ul class='w-full px-10'>")

                $.each(data["highlights"], function (i, highlight) {
                    let new_highlight_div = $("<li class='mb-3'>")
                    $(new_highlight_div).append("<h3 class='font-bold text-sm mb-1'>" + highlight["title"] + "</h3>");
                    $(new_highlight_div).append("<p>" + highlight["description"] + "</p>");
                    $(new_highlight_div).append("</li>");
                    $("#display_highlights").append(new_highlight_div);
                })
                $("#display_highlights").append("</ul>");
                show_team_members(data);
            }

            /* TEAM */

            function show_team_members(data) {
                $("#display_team").empty()
                $.each(data["team"], function (i, item) {
                    let new_team_member_div = $("<button class='team_member_div py-3 px-3 pb-2 pt-2.5 shadow-md no-underline rounded-full bg-slate-500 text-white font-sans font-semibold text-sm border-gray btn-primary hover:text-white hover:bg-slate-300 focus:outline-none active:shadow-none'>")
                    $(new_team_member_div).text(" " + item.name + " ").click(function (x) {
                        console.log(" " + item.name + " ");
                    })
                    $("#display_team").append(new_team_member_div)
                })
            }

            /* TEAM MEMBERS */

            $(function () {
                $("#get_team_member_btn").click(function () {
                    console.log("get_team_member_btn")
                    let prompt = team_data
                    show_team_members(prompt);
                })
            });

            function submit_prompt(prompt) {
                let data = {"prompt": prompt}
                $.ajax({
                    type: "POST",
                    url: "/report",
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(data),
                    beforeSend: function () {
                        {#$("#spinner-div").show()#}
                    },
                    success: function (data) {
                        team_data = JSON.parse(JSON.stringify(data));
                        var temp_summary = JSON.parse(JSON.stringify(team_data["report"]));
                        console.log(temp_summary);
                         $("#get_team_member_btn").show();
                         $("#edit_prompt_btn").show();
                         $("#summary-container").show();
                        show_summary(temp_summary);
                        show_team_members(temp_summary);
                    },
                    error: function (request, status, error) {
                        console.log("Error");
                        console.log(request)
                        console.log(status)
                        console.log(error)
                    },
                    complete: function () {
                        {#$("#spinner-div").hide()#}
                    },
                });
            }

            function edit_prompt() {
                show_prompt_editing(team_data)
            }

        </script>

        <div id='root' class='w-16 md:w-32 lg:w-48 flex content-start'>
            <div class="mx-50 content-center mt-18 h-56 mb-20">
                <div class="w-80">
                    <div class="flex items-start mb-30">
                        <div class="justify-center my-12 ml-20" id="edit_summary_div">
                            <form class="py-3 px-2 bg-slate-100 rounded-2xl">
                                <h1 class="self-center text-center text-xl text-gray-700 text-center font-bold mb-4 mt-6">Enter Github Data</h1>
                                <div class="self-center mb-6 mt-8">
                                    <div class="py-2 px-5 ml-20 mr-20">
                                        <textarea id="prompt_input" cols="50" rows="14"  class="w-80 sm:w-90 text-base text-gray-700 placeholder-gray-600 border rounded-lg focus:shadow-outline" value={this.state.entry}></textarea>
                                    </div>
                                    <div class="py-2 px-5 ml-20 mr-20">
                                        <button id="submit_prompt_btn" class="w-80 sm:w-90 bg-blue-500 hover:bg-gray-400 text-white text-xl font-semibold py-4 px-20 rounded-lg" type="button">Generate</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div id="show_summmary_div" class="justify-center my-12 mx-20">
                            <div class="py-3 bg-slate-100 rounded-2xl px-30 mb-10">
                                <h1 class="self-center text-center text-xl text-gray-700 text-center font-bold mb-6 mt-6 mx-20 px-20">Summary</h1>
                                <div id="summary-container" class="mb-6 px-5">
                                    <p id="show_summary" class="w-90 sm:w-90 h-48 max-w-full overflow-y-hidden break-words"></p>
                                </div>
                                 <div id="display_highlights" class="mb-6 px-10"></div>
                                <div class="py-2 px-5 ml-20 mr-20">
                                    <button id="edit_prompt_btn" type="button" class="w-80 sm:w-90 bg-blue-500 hover:bg-gray-400 text-white text-xl font-semibold py-4 px-20 rounded-lg">Edit</button>
                                </div>
                            </div>
                        </div>
                        <div id="team_member_to_select" class="justify-center my-12 mr-20">
                            <div class="py-3 bg-slate-100 rounded-2xl px-30 mb-10">
                                <h1 class="self-center text-center text-xl text-gray-700 text-center font-bold mb-6 mt-6 mx-20 px-20">Team</h1>
                                <div id="display_team" class="mb-6 px-10"></div>
                                <div class="py-2 px-10 ml-20 mr-20">
                                    <button type="button" id="get_team_member_btn" class="w-80 sm:w-90 bg-blue-500 hover:bg-gray-400 text-white text-xl font-semibold py-4 px-10 rounded-lg">Get Team Member</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
{% endblock %}

