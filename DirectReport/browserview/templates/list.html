{% extends "base.html" %}

{% block header %}
    {% block title %} {% endblock %}
{% endblock %}

{% block content %}
    <main>
        <div id="root" class='my-10 md:max-lg:flex content-start'></div>
        <script type="text/babel">
            const { useState, useEffect } = React;

            const TeamData = () => {
                const [teamData, setTeamData] = useState({});
                const [commentText, setCommentText] = useState("")
                const [generatedEmail, setGeneratedEmail] = useState("")

                const handleSubmit = e => {
                    e.preventDefault()
                    var dataForm = {
                        "prompt": commentText
                    };
                    const formDataJsonString = JSON.stringify(dataForm);
                    fetch("/report", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Accept": "application/json"
                        },
                        body: formDataJsonString
                    }).then(function(res) {
                        return res.json();
                    }).then(function(data) {
                        setTeamData(data);
                    });
                };

                const handleClick = e => {
                    e.preventDefault()
                    var dataForm = {
                        "prompt": JSON.stringify(teamData)
                    };
                    const formDataJsonString = JSON.stringify(dataForm);
                    fetch("/generate_email", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Accept": "application/json"
                        },
                         body: formDataJsonString
                    }).then(function(res) {
                        return res.json();
                    }).then(function(data) {
                        setGeneratedEmail(data["email"]);
                    });
                }

                return (
                    <div class="grid grid-cols-3 gap-1 mb-20 mx-10">
                        <div class="col-span-1 justify-center my-10" id="edit_summary_div">
                            <div class="shadow-lg py-3 bg-blue-500 rounded-2xl px-30 mb-10">
                                <form class="border-none py-3 px-2" onSubmit={handleSubmit}>
                                    <h1 class="self-center text-center text-2xl text-white text-center font-bold mb-4 mt-5">Enter Github Data</h1>
                                    <div class="self-center mb-6 mt-8">
                                        <div class="py-5 px-10 mx-0 min-w-full flex flex-col items-center">
                                            <textarea id="prompt_input" cols="40" rows="14" class="self-center border-none w-90 sm:w-90 text-base text-gray-700 placeholder-gray-600 border rounded-lg focus:shadow-outline" value={commentText}  onChange={e => setCommentText(e.target.value)} ></textarea>
                                        </div>
                                        <div class="px-10 mx-0 min-w-full flex flex-col items-center">
                                            <button id="submit_prompt_btn" class="shadow-md w-80 sm:w-90 bg-white hover:bg-black text-blue-500 text-xl font-semibold py-4 px-10 rounded-lg mt-10"  type="submit">Generate</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div id="show_summmary_div" class="col-span-1 justify-center my-10 ml-10">
                            <div class="shadow-lg py-3 bg-blue-500 rounded-2xl px-30 mb-10">
                                <h1 class="self-center text-center text-2xl text-white text-center font-bold mb-6 mt-8 mx-20 px-20">Summary</h1>
                                <div id="summary" class="py-5 px-5 mx-0 min-w-full flex flex-col items-center">
                                    <div id="summary-container" class="mb-6 bg-white ml-10 mr-10 rounded-2xl py-5 tracking-wide text-gray-500 md:text-gl dark:text-gray-400 px-5 my-2">
                                        <p id="show_summary" class="w-90 sm:w-90 max-w-full overflow-y-hidden break-words">
                                            { teamData["report"] !== undefined ?
                                                <div className="mb-6 px-10">{teamData["report"]["summary"]}</div>
                                                : null
                                            }
                                        </p>
                                        <div>
                                            <ul className="w-full px-10">
                                                {teamData["report"] &&
                                                    teamData["report"]["highlights"].map(hightlight =>
                                                        <li className="mb-3">
                                                            <h3 className="font-bold text-sm mb-1">{hightlight.title}</h3>
                                                            <p>{hightlight.description}</p>
                                                        </li>
                                                    )}
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="team_member_to_select" class="col-span-1 justify-center my-10 ml-10">
                            <div class="shadow-lg py-3 bg-blue-500 rounded-2xl px-10 mb-10">
                                <h1 class="self-center text-center text-2xl text-white text-center font-bold mb-6 mt-8 mx-20 px-20">
                                    Team</h1>
                                <div id="display_team" class="mb-6 my-14"></div>
                                <div className="py-3 bg-slate-100 rounded-2xl ml-5 mx-5 px-10">
                                    <h1 className="text-center text-xl text-gray-700 font-bold mb-6 mt-6 px-20 w-full">Team Members</h1>
                                    <div class="my-8 select-none">
                                        {teamData["team"] &&
                                            teamData["team"].map(teammember =>
                                                <button className="py-3 px-3 pb-2 pt-2.5 shadow-md no-underline rounded-full bg-slate-500 text-white font-sans font-semibold text-sm border-gray btn-primary hover:text-white hover:bg-slate-300 focus:outline-none active:shadow-none">{teammember.name}</button>
                                            )}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-span-3 my-12 ml-10 mr-20 mb-20 mt-10">
                            <div class="shadow-lg py-3 bg-blue-500 rounded-2xl px-30">
                                <h1 class="self-center text-center text-2xl text-white text-center font-bold w-100 mb-10 mt-5">Generated Email</h1>
                                <div id ="text-content" class="bg-white ml-20 mr-20 rounded-2xl py-20 tracking-wide text-gray-500 md:text-md dark:text-gray-400 px-20 mx-20 my-10">
                                    {generatedEmail}
                                </div>
                                <div class="py-10 px-10 min-w-full flex flex-col items-center">
                                    <button type="button" id="generate_email_btn" class="shadow-md w-80 sm:w-90 bg-white hover:bg-black text-blue-500 text-xl font-semibold py-4 px-10 rounded-lg" onClick={handleClick}>Generate Email</button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };
            const root = ReactDOM.createRoot(document.getElementById("root"));
            root.render(<TeamData />);
        </script>
        </body>
    </main>
{% endblock %}